(function(){"use strict";angular.module("subman",["subman.login","subman.manage","subman.signUp","ngSanitize"])})(),function(){"use strict";angular.module("subman.login",["core","dataServices"])}(),function(){"use strict";function n(n,t){function r(){i.queryParams=n.parseQueryString(window.location.search.substring(1));i.queryParams.loggedout==="true"&&(i.mainError="We're sorry, your session has expired.  Please log back in by clicking the link in an email you previously received, or use the form below to generate a new login email.")}function u(n){return i.loginFormSubmitting=!0,i.loginSent=!1,i.loginSentError=!1,i.mainError="",t.SendLogin({subscriberEmail:n}).$promise.then(function(){i.loginSent=!0}).catch(function(n){return n.status===404?(i.mainError="Oh no! It looks like we don't have you in our system. Just let us know a little bit about you and you'll be on your way to receiving UW email.",i.showSignUp=!0):i.loginSentError=!0,$q.reject(n)}).finally(function(){i.loginFormSubmitting=!1})}var i=this;i.loginEmail="";i.loginFormSubmitting=!1;i.loginSent=!1;i.loginSentError=!1;i.mainError="";i.showSignUp=!1;i.Lead=null;i.queryParams;i.submitLogin=u;r()}angular.module("subman.login").controller("SubManLoginController",n);n.$inject=["utilities","LoginService"]}(),function(){"use strict";function n(n,t){function r(n){return i.save({},n)}var i=n(t.applicationRoot+"SubscriptionManagement/SendLogin",{},{save:{method:"POST"}});return{SendLogin:r}}angular.module("dataServices").factory("LoginService",n);n.$inject=["$resource","ServerSettings"]}(),function(){"use strict";angular.module("subman.signUp",[])}(),function(){"use strict";function n(n){function i(){return t.signUpFormSubmitting=!0,t.signUpFormSent=!1,t.signUpFormSentError=!1,n.Submit({Lead:t.Lead}).$promise.then(function(){t.signUpFormSent=!0}).catch(function(n){return t.signUpFormSentError=!0,$q.reject(n)}).finally(function(){t.signUpFormSubmitting=!1})}var t=this;t.signUpFormSubmitting=!1;t.signUpFormSent=!1;t.signUpFormSentError=!1;t.mainError="";t.Lead=null;t.Errors={};t.Errors.SubscriptionIdMissing=!1;t.submitSignUp=i}angular.module("subman.signUp").controller("SubManSignUpController",n);n.$inject=["SignUpService"]}(),function(){"use strict";function n(n,t){function r(n){return i.save({},n)}var i=n(t.applicationRoot+"SignUp/SignUp",{},{save:{method:"POST"}});return{Submit:r}}angular.module("dataServices").factory("SignUpService",n);n.$inject=["$resource","ServerSettings"]}(),function(){"use strict";angular.module("subman.manage",["core","tree","dataServices"])}(),function(){"use strict";function n(n,t,i,r,u,f){function h(){this.Lead=null;this.SubscriptionID=null;this.MySubscriptions=null;this.AllSubscriptions=null;this.SetUpParameters=null;this.managePrefSuccess=!1;this.mySubscriptionsSuccess=!1;this.updateInfoSuccess=!1;this.manageAllSuccess=!1;this.managePreferences={active:!1,selectedInterest:[]};this.paths={};this.setIndexData=l;this.getMineFromAll=a;this.getSelectedInterestFromID=o;this.clearTabMessaging=v;this.submitPreferences=y;this.globalOptOut=p;this.globalOptIn=w;this.unsubscribe=b;this.updateInfo=k;this.getManageModel=c}function c(){return i.GetModel().$promise.then(function(n){e.manageService.setIndexData(n);e.manageService.MySubscriptions=e.manageService.getMineFromAll(n.AllSubscriptions)}).catch(function(n){return t.reject(n)})}function l(n){this.Lead=n.Lead;this.SubscriptionID=parseInt(n.SubMan.SubscriptionID,10);this.AllSubscriptions=n.AllSubscriptions;this.SetUpParameters=n.SubMan}function o(n){var t=null,i=function i(r){for(var u=0;u<r.length;u++)if(r[u].SubscriptionID===n){t=r[u];break}else r[u].Children&&r[u].Children.length>0&&i(r[u].Children)};return i(e.manageService.AllSubscriptions),t}function a(n){var t=[],i=function i(n){for(var r=0;r<n.length;r++)n[r].LeadSubscribed?t.push(n[r]):n[r].Children&&n[r].Children.length>0&&i(n[r].Children)},r=function(){var i=function(n){for(var r="",t=n,i=[];t.ParentID!==0;)t=o(t.ParentID),r=t.DisplayName,i.unshift(t);e.manageService.paths[n.SubscriptionID]=i},n;if(t.length>0)for(n=0;n<t.length;n++)i(t[n])};return i(n),r(),t}function v(){n(function(){e.manageService.mySubscriptionsSuccess=!1;e.manageService.manageAllSuccess=!1;e.manageService.managePrefSuccess=!1;e.manageService.updateInfoSuccess=!1;r.msg=""})}function y(){var n={AllSubscriptions:e.manageService.AllSubscriptions};return r.msg="",u.Submit(n).$promise.then(function(n){s(n)}).catch(function(n){return r.showDefault(),t.reject(n)})}function p(){return r.msg="",u.GlobalOptOut().$promise.then(function(n){e.manageService.Lead=n}).catch(function(n){return r.showDefault(),t.reject(n)})}function w(){return r.msg="",u.GlobalOptIn().$promise.then(function(n){e.manageService.Lead=n}).catch(function(n){return r.showDefault(),t.reject(n)})}function b(n){var i={subscriptionName:n};return r.msg="",u.Unsubscribe(i).$promise.then(function(n){s(n)}).catch(function(n){return r.showDefault(),t.reject(n)})}function k(){var n={Lead:e.manageService.Lead};return r.msg="",f.Submit(n).$promise.then(function(n){e.manageService.Lead=n}).catch(function(n){return n.status===304&&n.statusText.toLowerCase()==="pending verification"?t.reject(n):(n.status===304?n.statusText.toLowerCase()==="email exists"?r.msg="We're sorry, the update failed because this email address already exists in our database.":r.showDefault():r.showDefault(),t.reject(n))})}function s(n){var t;e.manageService.AllSubscriptions=n;e.manageService.MySubscriptions=e.manageService.getMineFromAll(n);e.manageService.managePreferences.active&&(t=e.manageService.getSelectedInterestFromID(e.manageService.managePreferences.selectedInterest[0].SubscriptionID),e.manageService.managePreferences.selectedInterest=[t])}var e={manageService:new h};return e}angular.module("subman.manage").factory("SubManManageViewModel",n);n.$inject=["$timeout","$q","ManageModelService","ManageErrorService","UpdateSubscriptionService","UpdateInformationService",]}(),function(){"use strict";function n(n,t,i,r){function e(){$(document).on("shown.bs.tab",'a[data-toggle="tab"]',function(n){location.hash=$(n.target).attr("href").substr(1);s()});u.manageService.getManageModel().then(function(){var t=null;u.urlHash!==""?(f(u.manageService.AllSubscriptions),u.showContent=!0,n(function(){u.evaluateUrlHash()})):(u.manageService.SubscriptionID!==null&&u.manageService.SetUpParameters.ManagePref&&(t=u.manageService.getSelectedInterestFromID(u.manageService.SubscriptionID),t!==null&&(r.setExpander(t.SubscriptionID,!0),u.manageService.managePreferences.selectedInterest.push(t),u.manageService.managePreferences.active=!0)),f(u.manageService.AllSubscriptions),u.showContent=!0)}).catch(function(){u.modelError=!0;u.showContent=!0})}function o(){$("#manageTabs a[href='"+u.urlHash+"']").tab("show")}function f(n){var i=r.hasCheckedChildren,t=function t(n){for(var f=0;f<n.length;f++)n[f].SubscriptionID===1||u.manageService.managePreferences.active&&n[f].SubscriptionID===u.manageService.managePreferences.selectedInterest[0].SubscriptionID?r.setExpander(n[f].SubscriptionID,!0):r.setExpander(n[f].SubscriptionID,i(n[f])),n[f].Children&&n[f].Children.length>0&&t(n[f].Children)};t(n)}function s(){u.manageService.clearTabMessaging()}var u=this;angular.extend(u,i);u.evaluateUrlHash=o;u.mainError=t;u.showContent=!1;u.modelError=!1;u.urlHash=window.location.hash.replace("/","");e()}angular.module("subman.manage").controller("SubManManageController",n);n.$inject=["$timeout","ManageErrorService","SubManManageViewModel","TreeService"]}(),function(){"use strict";function n(n){function i(){return t.submitting=!0,t.manageService.manageAllSuccess=!1,t.manageService.submitPreferences().then(function(){t.manageService.manageAllSuccess=!0}).finally(function(){t.submitting=!1})}function r(){t.submitting=!0;t.manageService.manageAllSuccess=!1;t.manageService.globalOptOut().finally(function(){t.submitting=!1})}var t=this;angular.extend(t,n);t.submit=i;t.submitting=!1;t.globalOptOut=r}angular.module("subman.manage").controller("SubManManageAllController",n);n.$inject=["SubManManageViewModel"]}(),function(){"use strict";function n(n){return{restrict:"A",link:function(t,i,r){var u;r.mySubscription==="true"&&(u=$(i),u.addClass("sub-highlighter"),n(function(){$("html, body").animate({scrollTop:u.offset().top},750)},500))}}}angular.module("tree").directive("mySubscription",n);n.$inject=["$timeout"]}(),function(){"use strict";function n(n,t){function r(n){return i.submitting[n]=!0,i.manageService.mySubscriptionsSuccess=!1,i.manageService.unsubscribe(n).then(function(){i.manageService.mySubscriptionsSuccess=!0}).finally(function(){i.submitting[n]=!1})}function u(n){i.manageService.managePreferences.selectedInterest=[];i.manageService.managePreferences.selectedInterest.push(n);i.manageService.managePreferences.active=!0;i.manageService.clearTabMessaging()}var i=this;angular.extend(i,t);i.unsubscribe=r;i.submitting={};i.paths={};i.setActiveInterest=u}angular.module("subman.manage").controller("SubManMySubscriptionsController",n);n.$inject=["$scope","SubManManageViewModel"]}(),function(){"use strict";function n(n){function i(){return t.submitting=!0,t.manageService.managePrefSuccess=!1,t.manageService.submitPreferences().then(function(){t.manageService.managePrefSuccess=!0}).finally(function(){t.submitting=!1})}function r(){t.manageService.managePreferences.selectedInterest=[];t.manageService.managePreferences.active=!1;t.manageService.clearTabMessaging()}function u(){t.submitting=!0;t.manageService.managePrefSuccess=!1;t.manageService.globalOptOut().finally(function(){t.submitting=!1})}function f(n){var r=t.manageService.getSelectedInterestFromID(n),i=function i(n){for(var t=0;t<n.length;t++)n[t].Children&&n[t].Children.length>0?i(n[t].Children):n[t].LeadSubscribed=!1};i(r.Children);t.submit()}var t=this;angular.extend(t,n);t.submitting=!1;t.submit=i;t.backToMySubscriptions=r;t.globalOptOut=u;t.unsubscribeFromAll=f}angular.module("subman.manage").controller("SubManManagePreferencesController",n);n.$inject=["SubManManageViewModel"]}(),function(){"use strict";function n(n){function i(){return t.submitting=!0,t.manageService.updateInfoSuccess=!1,t.pending=!1,t.manageService.updateInfo().then(function(){t.manageService.updateInfoSuccess=!0}).catch(function(n){return n.status===304&&n.statusText.toLowerCase()==="pending verification"&&(t.pending=!0),$q.reject(n)}).finally(function(){t.submitting=!1})}var t=this;angular.extend(t,n);t.submitting=!1;t.pending=!1;t.submit=i}angular.module("subman.manage").controller("SubManUpdateInfoController",n);n.$inject=["SubManManageViewModel","ManageErrorService","UpdateInformationService"]}(),function(){"use strict";function n(n){function i(){return t.globalOptInSubmitting=!0,t.manageService.mySubscriptionsSuccess=!1,t.manageService.manageAllSuccess=!1,t.manageService.managePrefSuccess=!1,t.manageService.globalOptIn().then(function(){t.manageService.mySubscriptionsSuccess=!0;t.manageService.manageAllSuccess=!0;t.manageService.managePrefSuccess=!0}).finally(function(){t.globalOptInSubmitting=!1})}var t=this;angular.extend(t,n);t.globalOptInSubmitting=!1;t.globalOptIn=i}angular.module("subman.manage").controller("SubManGlobalOptController",n);n.$inject=["SubManManageViewModel","ManageErrorService"]}(),function(){"use strict";function n(){function n(){var n='<div ng-if="vm.manageService.Lead.unsubscribed === true">';return n+='<div class="alert alert-danger">',n+='<span class="icon-remove"><\/span>',n+='You have opted out of all email communication. <a ng-click="gOptCtrl.globalOptIn()" style="text-decoration:underline;cursor:pointer">Click here<\/a> to opt back in and start receiving email again. <span class="spinner" style="position:relative;top:3px;" ng-show="gOptCtrl.globalOptInSubmitting">',n+="<\/span>",n+="<\/div>",n+"<\/div>"}return{restrict:"E",controller:"SubManGlobalOptController",controllerAs:"gOptCtrl",template:n}}angular.module("subman.manage").directive("globalOpt",n)}(),function(){"use strict";function n(){function t(t){var i=typeof t!="undefined"?t:"mktohelp@uw.edu";n.msg="Sorry, we're having trouble updating your record at this time. Please email <a href=\"mailto:"+i+'"><u>'+i+"<\/u><\/a> if this problem persists."}var n={msg:"",showDefault:t};return n}angular.module("subman.manage").factory("ManageErrorService",n)}(),function(){"use strict";function n(n,t){function r(){return i.get()}var i=n(t.applicationRoot+"SubscriptionManagement/GetManageModel",{},{get:{method:"GET"}});return{GetModel:r}}angular.module("dataServices").factory("ManageModelService",n);n.$inject=["$resource","ServerSettings"]}(),function(){"use strict";function n(n){function r(n){var i,t;if(n.Children&&n.Children.length>0){for(i=!1,t=0;t<n.Children.length;t++)if(n.Children[t].LeadSubscribed!==!0){i=!0;break}return!i}return n.LeadSubscribed?!0:!1}function i(t,r,u){var o=u==="allUW"?$("#allUW-center"):$("#preferences-center"),e=$("input[id='"+t.SubscriptionID+"']",o).is(":checked"),f;if(u==="test"&&(e=!0),e||r)for(n.setExpander(t.SubscriptionID,!0),f=0;f<t.Children.length;f++)t.Children[f].Children&&t.Children[f].Children.length>0?($("input[id='"+t.Children[f].SubscriptionID+"']").attr("checked",!0),i(t.Children[f],!0)):t.Children[f].LeadSubscribed=!0;else if(!e||!r)for(f=0;f<t.Children.length;f++)t.Children[f].Children&&t.Children[f].Children.length>0?($("input[id='"+t.Children[f].SubscriptionID+"']").attr("checked",!1),i(t.Children[f],!1)):t.Children[f].LeadSubscribed=!1}var t=this;t.expander=n.getExpanderList();t.hasCheckedChildren=n.hasCheckedChildren;t.allChildrenChecked=r;t.checkChildren=i}angular.module("tree").controller("TreeController",n);n.$inject=["TreeService"]}(),function(){"use strict";function n(){function t(t,i){n[t]=i}function i(){return n}function r(n){var t=!1,i=function i(n){for(var r=0;r<n.length;r++)if(n[r].LeadSubscribed){t=!0;break}else n[r].Children&&n[r].Children.length>0&&i(n[r].Children)};if(n.Children&&n.Children.length>0)i(n.Children);else return!1;return t}var n={};return{setExpander:t,getExpanderList:i,hasCheckedChildren:r}}angular.module("tree").factory("TreeService",n)}(),function(){"use strict";function n(n){return{restrict:"E",templateUrl:n.applicationRoot+"Scripts/app/shared/tree/tree.html",scope:{preferences:"=preferences",lead:"=lead",type:"@treeType",inputsDisabled:"@inputsDisabled"},link:function(n){n.url=n.type+".html"}}}angular.module("tree").directive("subscriptionTree",n);n.$inject=["ServerSettings"]}(),function(){"use strict";function n(n,t){var i=n(t.applicationRoot+"SubscriptionManagement/UpdateSubscription",{},{save:{method:"POST",isArray:!0}}),r=n(t.applicationRoot+"SubscriptionManagement/Unsubscribe",{},{save:{method:"POST",isArray:!0}}),u=n(t.applicationRoot+"SubscriptionManagement/GlobalOptOut",{},{save:{method:"POST"}}),f=n(t.applicationRoot+"SubscriptionManagement/GlobalOptBackIn",{},{save:{method:"POST"}});return{Submit:function(n){return i.save({},n)},Unsubscribe:function(n){return r.save({},n)},GlobalOptOut:function(){return u.save({})},GlobalOptIn:function(){return f.save({})}}}angular.module("dataServices").factory("UpdateSubscriptionService",n);n.$inject=["$resource","ServerSettings"]}(),function(){"use strict";function n(n,t){var i=n(t.applicationRoot+"SubscriptionManagement/UpdateInformation",{},{save:{method:"POST"}});return{Submit:function(n){return i.save({},n)}}}angular.module("dataServices").factory("UpdateInformationService",n);n.$inject=["$resource","ServerSettings"]}()